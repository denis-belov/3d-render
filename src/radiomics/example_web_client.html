<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiomics Feature Extraction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            background-color: #fafafa;
            cursor: pointer;
        }
        input[type="file"]:hover {
            border-color: #4CAF50;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .progress {
            margin-top: 20px;
            display: none;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background-color: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        .info {
            background-color: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß¨ Radiomics Feature Extraction</h1>

        <div class="info">
            <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (.nii) –∏ —Ñ–∞–π–ª –º–∞—Å–∫–∏ (.nii),
            –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ò–∑–≤–ª–µ—á—å –ø—Ä–∏–∑–Ω–∞–∫–∏" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
        </div>

        <form id="radiomicsForm">
            <div class="form-group">
                <label for="imageFile">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (Image) - .nii —Ñ–∞–π–ª:</label>
                <input type="file" id="imageFile" accept=".nii" required>
            </div>

            <div class="form-group">
                <label for="maskFile">–ú–∞—Å–∫–∞ (Mask) - .nii —Ñ–∞–π–ª:</label>
                <input type="file" id="maskFile" accept=".nii" required>
            </div>

            <div class="form-group">
                <label for="serverUrl">URL —Å–µ—Ä–≤–µ—Ä–∞:</label>
                <input type="text" id="serverUrl" value="http://localhost:8080/radiomics"
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <button type="submit" id="submitBtn">–ò–∑–≤–ª–µ—á—å –ø—Ä–∏–∑–Ω–∞–∫–∏</button>
        </form>

        <div class="progress" id="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <p id="progressText" style="text-align: center; margin-top: 10px;"></p>
        </div>

        <div class="result" id="result"></div>
    </div>

    <script>
        const form = document.getElementById('radiomicsForm');
        const submitBtn = document.getElementById('submitBtn');
        const progress = document.getElementById('progress');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const result = document.getElementById('result');

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(percent, text) {
            progress.style.display = 'block';
            progressFill.style.width = percent + '%';
            progressFill.textContent = percent + '%';
            progressText.textContent = text;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function showResult(success, data) {
            progress.style.display = 'none';
            result.style.display = 'block';
            result.className = 'result ' + (success ? 'success' : 'error');

            if (success) {
                result.innerHTML = `
                    <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3>
                    <p><strong>Session ID:</strong> ${data.session_id}</p>
                    <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:</strong> ${data.features_count}</p>
                    <details>
                        <summary style="cursor: pointer; margin-top: 10px;"><strong>–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏</strong></summary>
                        <pre>${JSON.stringify(data.features, null, 2)}</pre>
                    </details>
                    <details>
                        <summary style="cursor: pointer; margin-top: 10px;"><strong>–°–∫–∞—á–∞—Ç—å CSV</strong></summary>
                        <pre style="max-height: 200px;">${data.csv_data}</pre>
                    </details>
                `;
            } else {
                result.innerHTML = `
                    <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                    <p>${data.message || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                `;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const imageFile = document.getElementById('imageFile').files[0];
            const maskFile = document.getElementById('maskFile').files[0];
            const serverUrl = document.getElementById('serverUrl').value;

            if (!imageFile || !maskFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±–∞ —Ñ–∞–π–ª–∞');
                return;
            }

            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            submitBtn.disabled = true;
            updateProgress(10, '–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤...');

            try {
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º FormData —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
                updateProgress(30, '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤...');
                console.log('Preparing files:', imageFile.name, imageFile.size, 'bytes', maskFile.name, maskFile.size, 'bytes');

                const formData = new FormData();
                formData.append('image', imageFile, imageFile.name);
                formData.append('mask', maskFile, maskFile.name);
                formData.append('session_id', new Date().toISOString().replace(/[:.]/g, '-'));

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
                updateProgress(70, '–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
                const response = await fetch(serverUrl, {
                    method: 'POST',
                    body: formData
                    // –ù–µ —É–∫–∞–∑—ã–≤–∞–µ–º Content-Type - –±—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å boundary –¥–ª—è multipart/form-data
                });

                updateProgress(90, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞...');

                const resultData = await response.json();

                if (response.ok && resultData.status === 'success') {
                    updateProgress(100, '–ì–æ—Ç–æ–≤–æ!');
                    showResult(true, resultData);
                } else {
                    showResult(false, resultData);
                }

            } catch (error) {
                console.error('Error:', error);
                showResult(false, {
                    message: `–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.message}. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ ${serverUrl}`
                });
            } finally {
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>

